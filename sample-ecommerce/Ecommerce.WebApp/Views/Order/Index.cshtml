@{
    ViewData["Title"] = "Index";
}
<!-- Breadcrumb Section Begin -->
<section class="breadcrumb-section set-bg" data-setbg="/client/img/breadcrumb.jpg">
    <div class="container">
        <div class="row">
            <div class="col-lg-12 text-center">
                <div class="breadcrumb__text">
                    <h2>Checkout</h2>
                    <div class="breadcrumb__option">
                        <a href="/">Home</a>
                        <span>Checkout</span>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>
<!-- Breadcrumb Section End -->
<!-- Checkout Section Begin -->
<section class="checkout spad">
    <div class="container">
        <div class="checkout__form">
            <h4>Chi Tiết Đơn Hàng</h4>
            <form method="post" asp-controller="Order" asp-action="CreateOrder">
                <div class="row">
                    <div class="col-lg-8 col-md-6">
                        <div class="checkout__input">
                            <p>Tên Người Nhận<span>*</span></p>
                            <input type="text" value="@ViewBag.UserInfo.FullName" name="ShipName" required>
                        </div>
                        <div class="checkout__input">
                            <p>Địa Chỉ<span>*</span></p>
                            <input type="text" placeholder="Address" class="checkout__input__add" value="@ViewBag.UserInfo.Address" name="ShipAddress" required>
                        </div>
                        <div class="row">
                            <div class="col-lg-6">
                                <div class="checkout__input">
                                    <p>Phone<span>*</span></p>
                                    <input type="text" value="@ViewBag.UserInfo.PhoneNumber" name="ShipPhoneNumber" required>
                                </div>
                            </div>
                            <div class="col-lg-6">
                                <div class="checkout__input">
                                    <p>Email<span>*</span></p>
                                    <input type="email" value="@ViewBag.UserInfo.Email" name="ShipEmail" required>
                                </div>
                            </div>
                        </div>

                        @*<div class="checkout__input">
                        <p>Order notes<span>*</span></p>
                        <input type="text"
                        placeholder="Notes about your order, e.g. special notes for delivery.">
                        </div>*@
                    </div>
                    <div class="col-lg-4 col-md-6">
                        <div class="checkout__order">
                            <h4>Sản Phẩm Của Bạn</h4>
                            <div class="checkout__order__products">Sản Phẩm <span>Thành Tiền</span></div>
                            <ul>
                                @foreach (var item in ViewBag.OrderItems)
                                {
                                    <li class="targetfields">
                                        @item.ProductName
                                        <br/>
                                        (@item.CartQuantity x @string.Format("{0:0,0}", item.CartPrice))
                                        <span class="shoping__cart__total">
                                            @string.Format("{0:0,0}", item.CartTotal) đ
                                        </span>
                                    </li>
                                }
                            </ul>
                            <div class="checkout__order__total">Tổng Tiền <span id="total">0</span></div>

                            <p>
                                Vui lòng kiểm tra thông tin trước khi đặt hàng!
                                Cảm ơn quý khách đã ủng hộ noithatbichthuy.com
                            </p>
                            <button type="submit" class="site-btn">ĐẶT HÀNG</button>
                        </div>
                    </div>
                </div>
            </form>
        </div>
    </div>
</section>
<!-- Checkout Section End -->

<script type="text/javascript">
    $(document).ready(function () {
        total_calculate();
    });

    function total_calculate() {
        var total = 0;
        // Loop through subtotal
        $(".targetfields .shoping__cart__total").each(function () {
            // Lấy giá trị và loại bỏ dấu ',' và 'đ'
            var value = $(this).text().replace(/,/g, '').replace(/đ/g, '').trim();
            // Check nếu không rỗng, parse thành số, ngược lại gán giá trị là 0
            value = value !== "" ? parseFloat(value) : 0;
            total += value; // Cộng dồn giá trị
        });

        // Gán giá trị tổng vào span #total
        $("#total").text(formatCurrency(total));
    }

    // Hàm định dạng tiền VND
    function formatCurrency(amount) {
        return amount.toLocaleString('vi-VN') + " đ";
    }

</script>